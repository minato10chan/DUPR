# ピックルボール練習試合ダブルス組み合わせ管理システム

ピックルボール（テニス）のダブルス練習試合における参加者管理、ペアリング、対戦組み合わせ生成、試合結果記録を総合的に管理するWebアプリケーションです。

## 主要機能

### 1 ユーザー管理システム
- 永続的なユーザー登録（名前、初期レーティング、メモ）
- ユーザー情報の編集・削除
- 戦績の自動蓄積（総試合数、勝利数、勝率）

### 2 参加者選択システム
- 登録ユーザーからの選択（検索機能付き）
- ゲスト参加者の追加
- 一括追加機能

### 3 参加者管理
- 個別追加・一括追加
- 参加状態管理（アクティブ/非アクティブ）
- 名前・レーティング編集

###4 高度なペアリングシステム
- **通常モード**: バイ履歴・ペア履歴を考慮した公平な組み合わせ
- **レベル考慮モード**: レーティング差200以内でのグループ化

### 5. ラウンド生成・管理
- 複数ラウンド同時生成（1-10ラウンド）
- コート数設定
- ラウンド削除・完了管理

### 6. 試合結果記録システム
- スコア入力・勝敗判定
- 視覚的表示（勝利チームハイライト）
- 編集機能

### 7 レーティングシステム
- 自動計算（勝率ベース）
- 計算式:120+ (勝率 -05) × 800 範囲:80600

### 8. 表示システム
- テーブル表示（全ラウンド横並び）
- 詳細表示（ラウンド別詳細情報）

### 9. 履歴管理
- バイ履歴・ペア履歴・対戦履歴
- 完了ラウンド管理

## 技術仕様

- **フレームワーク**: Streamlit
- **データ保存**: JSONファイル
- **デプロイ**: Streamlit Cloud
- **依存関係**: pandas, numpy, plotly
- **アーキテクチャ**: モジュール分割（保守性向上）

## ファイル構成（リファクタリング版）

```
DUPR/
├── app_refactored.py          # メインアプリケーション（リファクタリング版）
├── app.py                     # メインアプリケーション（旧版）
├── requirements.txt           # 依存関係
├── .streamlit/
│   └── config.toml           # Streamlit設定
├── src/                      # ソースコードディレクトリ
│   ├── __init__.py
│   ├── data_manager.py       # データ管理モジュール
│   ├── rating_system.py      # レーティングシステム
│   ├── pairing_system.py     # ペアリングシステム
│   ├── match_manager.py      # 試合管理
│   ├── ui_components.py      # UIコンポーネント
│   └── pages/                # ページモジュール
│       ├── __init__.py
│       ├── user_management.py
│       ├── participant_management.py
│       ├── round_generation.py
│       └── statistics.py
├── README.md                 # このファイル
├── .gitignore               # Git除外設定
├── users.json               # ユーザーデータ（自動生成）
├── pair_history.json        # ペア履歴（自動生成）
├── bye_history.json         # バイ履歴（自動生成）
└── match_history.json       # 対戦履歴（自動生成）
```

## リファクタリングの改善点

###1モジュール分割
- **単一ファイル（670行）** → **複数モジュール**に分割
- 機能ごとの責任分離
- コードの可読性向上

### 2. クラスベース設計
- `DataManager`: データ管理
- `RatingSystem`: レーティング計算
- `PairingSystem`: ペアリング処理
- `MatchManager`: 試合管理
- `UIComponents`: 再利用可能UI

### 3 ページ分離
- 各ページを独立したモジュールに分離
- ページ間の依存関係を最小化
- テストしやすい構造

### 4. 保守性向上
- 機能追加・修正が容易
- バグの特定・修正が簡単
- コードの再利用性向上

## ユーザーフレンドリーUI改善

### 1. サイドバーの強化
- ロゴ画像とアプリ説明を追加
- ボタン形式のメニュー（ラジオボタンから変更）
- 選択中のページをハイライト表示

###2. 入力フォームの改善
- 必須項目の明示（*マーク）
- プレースホルダーと入力例
- 使い方ガイドの追加
- バリデーション強化

### 3. ラウンド生成・結果管理の統合
- **「🎯 ラウンド生成・結果管理」**として統合
- 全ラウンド一覧テーブル表示
- 各試合カード内でのスコア入力
- 視覚的な勝敗表示（🏆マーク、色分け）

### 4. 操作性の向上
- アイコン付きボタン
- 明確な成功・エラーメッセージ
- 直感的なレイアウト

## Streamlit Cloudでのデプロイ方法

### 1. GitHubリポジトリの準備
1. このプロジェクトをGitHubリポジトリにプッシュ2 以下のファイルが含まれていることを確認：
   - `app_refactored.py` (メインアプリケーション)
   - `requirements.txt` (依存関係)
   - `.streamlit/config.toml` (設定ファイル)
   - `src/` ディレクトリ（全モジュール）

### 2 Streamlit Cloudでのデプロイ
1. [Streamlit Cloud](https://share.streamlit.io/)にアクセス2. GitHubアカウントでログイン
3. New appをクリック
4. リポジトリ、ブランチ、メインファイルを選択：
   - Repository: `your-username/your-repo-name`
   - Branch: `main`
   - Main file path: `app_refactored.py`5. "Deploy!をクリック

###3プロイ後の設定
- アプリケーションが正常に起動することを確認
- データファイル（users.json, pair_history.json等）は自動的に作成されます

## 使用方法

###1. ユーザー登録
- 「👤 ユーザー管理」ページで新規ユーザーを登録
- 名前（必須）、初期レーティング（800-1600、メモを入力
- 使い方ガイドが表示されます

### 2 参加者追加
- 「👥 参加者管理」ページで参加者を追加
- 登録ユーザーから選択またはゲスト追加
- 一括追加機能も利用可能

### 3 ラウンド生成・結果管理
- 「🎯 ラウンド生成・結果管理」ページで設定
- ラウンド数、コート数、レベル考慮モードを選択
- 生成されたラウンドで直接スコア入力
- 全ラウンド一覧テーブルで全体を確認

### 4. 統計確認
- 「📈 統計・履歴」ページで各種統計を確認

## 開発・保守

### 新機能追加
1. 該当するモジュールを特定
2 機能を実装
3. 必要に応じてUIコンポーネントを追加
4. テスト実行

### バグ修正
1 エラーログから該当モジュールを特定2. 修正を実装3. 影響範囲を確認4. テスト実行

### コード品質
- 各モジュールは単一責任原則に従う
- 関数・クラスには適切なドキュメント文字列を記述
- 型ヒントを使用してコードの可読性を向上

## 注意事項

- データはJSONファイルで保存されるため、Streamlit Cloudの再起動時にデータが保持されます
- 大量のデータがある場合は、データベースの使用を検討してください
- レーティング更新は手動で行う必要があります
- 旧版（app.py）と新版（app_refactored.py）は互換性があります
- 結果ページはラウンド生成ページに統合されました

## ライセンス

MIT License 

##ローカルテスト
streamlit run app_refactored.py